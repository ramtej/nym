<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Coconut Credential Store</title>
    <link href="index.css" rel="stylesheet" />
    <script type="module">
      import { generateMnemonic, createBandwithCredential } from './index.js';

      let purchaseCredential = document.getElementById('purchaseCredential');
      let mnemonicInput = document.getElementById('mnemonic');
      let amountInput = document.getElementById('amount');
      let credentialLog = document.getElementById('credentialLog');

      let mnemonic = undefined;
      let amount = undefined;

      mnemonicInput.onkeydown = () => {
        if (mnemonicInput.value) {
          mnemonic = mnemonicInput.value;
        }
        if (mnemonicInput.value && amountInput.value) {
          purchaseCredential.disabled = false;
        } else {
          purchaseCredential.disabled = true;
        }
      };

      amountInput.onkeydown = () => {
        if (amountInput.value) {
          amount = amountInput.value;
        }
        if (mnemonicInput.value && amountInput.value) {
          purchaseCredential.disabled = false;
        } else {
          purchaseCredential.disabled = true;
        }
      };

      // Shimming console.log so it shows up in the browser
      console._log_old = console.log;
      console.log = (msg) => {
        credentialLog.innerHTML += `${msg}\n`;
        console._log_old(msg);
      };

      purchaseCredential.onclick = async () => {
        try {
          await createBandwithCredential(
            mnemonic,
            `${amount}unym`,
            {
              networkDetails: {
                networkName: 'sandbox',
                chainDetails: {
                  bech32AccountPrefix: 'n',
                  mixDenom: { base: 'unym', display: 'nym', displayExponent: 6 },
                  stakeDenom: { base: 'unyx', display: 'nyx', displayExponent: 6 },
                },
                endpoints: [
                  {
                    nyxdUrl: 'https://sandbox-validator1.nymtech.net',
                    nyxdApi: 'https://sandbox-nym-api1.nymtech.net',
                  },
                ],
                contracts: {
                  mixnetContractAddress: 'n1xr3rq8yvd7qplsw5yx90ftsr2zdhg4e9z60h5duusgxpv72hud3sjkxkav',
                  vestingContractAddress: 'n1unyuj8qnmygvzuex3dwmg9yzt9alhvyeat0uu0jedg2wj33efl5qackslz',
                  multisigContractAddress: 'n14ph4e660eyqz0j36zlkaey4zgzexm5twkmjlqaequxr2cjm9eprqsmad6k',
                  coconutBandwidthContractAddress: 'n16a32stm6kknhq5cc8rx77elr66pygf2hfszw7wvpq746x3uffylqkjar4l',
                  coconutDkgContractAddress: 'n1ahg0erc2fs6xx3j5m8sfx3ryuzdjh6kf6qm9plsf865fltekyrfsesac6a',
                  groupContractAddress: 'n1pd7kfgvr5tpcv0xnlv46c4jsq9jg2r799xxrcwqdm4l2jhq2pjwqrmz5ju',
                },
              },
            },
            { useSandbox: true },
          );
          credentialLog.innerHTML += 'Credential purchased\n';
        } catch (err) {
          credentialLog.innerHTML += `${err.message}\n`;
        }
      };
    </script>
  </head>
  <body>
    <div class="container">
      <h1>Welcome to the Coconut Store</h1>
      <div class="section">
        <label for="mnemonic">Mnemonic</label>
        <textarea class="input" id="mnemonic"></textarea>
      </div>
      <div class="section">
        <label for="amount">Amount of NYM to deposit</label>
        <input type="number" class="input" id="amount" />
      </div>
      <h2>Buy a coconut credential</h2>
      <div>
        <button disabled id="purchaseCredential">Purchase Bandwith Credential</button>
        <pre class="log" id="credentialLog"></pre>
      </div>
    </div>
  </body>
</html>
